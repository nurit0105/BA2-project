<!DOCTYPE html>
<html>
<head>
  <title>Handpose Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>
  <style>
    canvas, video { position: absolute; top: 0; left: 0; }
    #status { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.5); padding: 5px; }
  </style>
</head>
<body>
  <video id="video" autoplay playsinline width="640" height="480"></video>
  <canvas id="canvas" width="640" height="480"></canvas>
  <div id="status">Loading...</div>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const statusEl = document.getElementById('status');

    async function setupCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
      return new Promise(resolve => {
        video.onloadedmetadata = () => resolve(video);
      });
    }

    async function main() {
      await setupCamera();
      const model = await handpose.load();
      statusEl.textContent = 'Model Loaded';

      async function detect() {
        const predictions = await model.estimateHands(video, true);

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        if (predictions.length > 0) {
          const landmarks = predictions[0].landmarks;

          // Draw points
          for (let i = 0; i < landmarks.length; i++) {
            const [x, y, z] = landmarks[i];
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, 2 * Math.PI);
            ctx.fillStyle = 'lime';
            ctx.fill();
          }

          // Example gesture: "Thumbs Up" - check if thumb is extended and above other fingers
          const thumbTip = landmarks[4];
          const indexTip = landmarks[8];
          const pinkyTip = landmarks[20];

          if (thumbTip[1] < indexTip[1] && thumbTip[1] < pinkyTip[1]) {
            statusEl.textContent = 'Gesture: Thumbs Up';
          } else {
            statusEl.textContent = 'Gesture: (none)';
          }
        }

        requestAnimationFrame(detect);
      }

      detect();
    }

    main();
  </script>
</body>
</html>
